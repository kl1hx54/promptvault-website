<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromptVault Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #000000 0%, #1a0033 100%);
            color: white;
            min-height: 100vh;
        }

        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 60px 40px;
            max-width: 450px;
            width: 100%;
        }

        .login-box h1 {
            font-size: 32px;
            font-weight: 900;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #a855f7, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-box p {
            color: #9ca3af;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            outline: none;
            transition: all 0.3s;
        }

        .form-group input:focus {
            border-color: #9333ea;
            box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.1);
        }

        .btn-primary {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #9333ea, #ec4899);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(147, 51, 234, 0.4);
        }

        .admin-panel {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .admin-panel.active {
            display: block;
        }

        header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title h1 {
            font-size: 28px;
            font-weight: 900;
            background: linear-gradient(135deg, #a855f7, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn-secondary {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 24px;
        }

        .stat-card h3 {
            font-size: 14px;
            color: #9ca3af;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .stat-card .stat-value {
            font-size: 36px;
            font-weight: 900;
            background: linear-gradient(135deg, #a855f7, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .add-prompt-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .add-prompt-section h2 {
            font-size: 24px;
            font-weight: 900;
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        textarea {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            outline: none;
            font-family: inherit;
            resize: vertical;
            min-height: 120px;
        }

        textarea:focus {
            border-color: #9333ea;
            box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.1);
        }

        .tag-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }

        .tags-display {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .tag-chip {
            background: rgba(147, 51, 234, 0.2);
            border: 1px solid rgba(147, 51, 234, 0.3);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            color: #c084fc;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tag-chip button {
            background: none;
            border: none;
            color: #c084fc;
            cursor: pointer;
            font-size: 18px;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .prompts-list {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
        }

        .prompts-list h2 {
            font-size: 24px;
            font-weight: 900;
            margin-bottom: 20px;
        }

        .prompt-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            display: grid;
            grid-template-columns: 100px 1fr auto;
            gap: 20px;
            align-items: center;
        }

        .prompt-item img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 12px;
        }

        .prompt-info h4 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .prompt-info p {
            font-size: 14px;
            color: #9ca3af;
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .prompt-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-edit {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #60a5fa;
        }

        .btn-delete {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #f87171;
        }

        .btn-small:hover {
            transform: translateY(-2px);
        }

        .alert {
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .alert-success {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #86efac;
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #f87171;
        }

        .image-preview {
            width: 100%;
            max-width: 300px;
            height: 200px;
            object-fit: cover;
            border-radius: 12px;
            margin-top: 12px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            .prompt-item {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-box">
            <h1>üîê Admin Login</h1>
            <p>Enter credentials to access the admin panel</p>
            <form onsubmit="login(event)">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="username" required placeholder="admin">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button type="submit" class="btn-primary">Login</button>
            </form>
        </div>
    </div>

    <!-- Admin Panel -->
    <div class="admin-panel" id="adminPanel">
        <header>
            <div class="header-title">
                <h1>‚ú® PromptVault Admin üî•</h1>
            </div>
            <div class="header-actions">
                <button class="btn-secondary" onclick="exportData()">üì• Export Data</button>
                <button class="btn-secondary" onclick="logout()">üö™ Logout</button>
            </div>
        </header>

        <div id="alertContainer"></div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total Prompts</h3>
                <div class="stat-value" id="totalPrompts">0</div>
            </div>
            <div class="stat-card">
                <h3>Total Likes</h3>
                <div class="stat-value" id="totalLikes">0</div>
            </div>
            <div class="stat-card">
                <h3>Most Popular</h3>
                <div class="stat-value" id="mostPopular">-</div>
            </div>
        </div>

        <!-- Add Prompt Form -->
        <div class="add-prompt-section">
            <h2>‚ûï Add New Prompt</h2>
            <form onsubmit="addPrompt(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Image URL</label>
                        <input type="url" id="imageUrl" required placeholder="https://images.unsplash.com/...">
                    </div>
                    <div class="form-group">
                        <label>Initial Likes</label>
                        <input type="number" id="likes" value="0" min="0">
                    </div>
                </div>

                <div class="form-group">
                    <label>Prompt Text</label>
                    <textarea id="promptText" required placeholder="A detailed description of the AI-generated image..."></textarea>
                </div>

                <div class="form-group">
                    <label>Tags (comma-separated)</label>
                    <input type="text" id="tagsInput" placeholder="cyberpunk, neon, futuristic">
                    <div class="tags-display" id="tagsDisplay"></div>
                </div>

                <button type="submit" class="btn-primary">Add Prompt</button>
            </form>
        </div>

        <!-- Prompts List -->
        <div class="prompts-list">
            <h2>üìã Manage Prompts</h2>
            <div id="promptsList"></div>
        </div>
    </div>

    <script>
        // Admin credentials
        const ADMIN_CREDENTIALS = {
            username: 'munnuru.nani0543@gmail.com',
            password: 'Nani@1343'
        };

        let prompts = [];

        function login(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            console.log('Login attempt:', username); // Debug log

            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                console.log('Login successful!'); // Debug log
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminPanel').classList.add('active');
                sessionStorage.setItem('admin_logged_in', 'true');
                loadDashboard();
            } else {
                console.log('Login failed!'); // Debug log
                alert('Invalid credentials! Please check your email and password.');
            }
        }

        function logout() {
            sessionStorage.removeItem('admin_logged_in');
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('adminPanel').classList.remove('active');
        }

        async function loadDashboard() {
            // Wait for Firebase to be ready
            let attempts = 0;
            while (!window.loadPromptsFromFirebase && attempts < 20) {
                await new Promise(resolve => setTimeout(resolve, 100));
                attempts++;
            }
            
            if (window.loadPromptsFromFirebase) {
                await window.loadPromptsFromFirebase();
            }
            updateStats();
            renderPrompts();
        }

        function updateStats() {
            document.getElementById('totalPrompts').textContent = prompts.length;
            const totalLikes = prompts.reduce((sum, p) => sum + (p.likes || 0), 0);
            document.getElementById('totalLikes').textContent = totalLikes.toLocaleString();
            
            if (prompts.length > 0) {
                const mostPopular = prompts.reduce((max, p) => (p.likes || 0) > (max.likes || 0) ? p : max, prompts[0]);
                document.getElementById('mostPopular').textContent = mostPopular ? (mostPopular.likes || 0).toLocaleString() : '-';
            }
        }

        async function addPrompt(e) {
            e.preventDefault();

            const imageUrl = document.getElementById('imageUrl').value;
            const promptText = document.getElementById('promptText').value;
            const likes = parseInt(document.getElementById('likes').value) || 0;
            const tagsInput = document.getElementById('tagsInput').value;
            const tags = tagsInput.split(',').map(t => t.trim()).filter(t => t);

            const newPrompt = {
                image: imageUrl,
                prompt: promptText,
                tags: tags,
                likes: likes,
                date: new Date().toISOString().split('T')[0]
            };

            try {
                // Add to Firebase
                await window.addPromptToFirebase(newPrompt);
                
                // Reload from Firebase
                await window.loadPromptsFromFirebase();
                
                // Reset form
                e.target.reset();
                document.getElementById('tagsDisplay').innerHTML = '';
                
                showAlert('‚úÖ Prompt added successfully to Firebase!', 'success');
                updateStats();
                renderPrompts();
            } catch (error) {
                console.error('Error:', error);
                showAlert('‚ùå Error adding prompt: ' + error.message, 'error');
            }
        }

        async function deletePrompt(id) {
            if (confirm('Are you sure you want to delete this prompt?')) {
                try {
                    // Delete from Firebase
                    await window.deletePromptFromFirebase(id);
                    
                    // Reload from Firebase
                    await window.loadPromptsFromFirebase();
                    
                    showAlert('‚úÖ Prompt deleted successfully!', 'success');
                    updateStats();
                    renderPrompts();
                } catch (error) {
                    console.error('Error:', error);
                    showAlert('‚ùå Error deleting prompt: ' + error.message, 'error');
                }
            }
        }

        function renderPrompts() {
            const container = document.getElementById('promptsList');
            
            if (prompts.length === 0) {
                container.innerHTML = '<p style="color: #9ca3af; text-align: center; padding: 40px;">No prompts yet. Add your first prompt above!</p>';
                return;
            }

            container.innerHTML = prompts.map(prompt => `
                <div class="prompt-item">
                    <img src="${prompt.image}" alt="Prompt image">
                    <div class="prompt-info">
                        <h4>${prompt.prompt.substring(0, 80)}${prompt.prompt.length > 80 ? '...' : ''}</h4>
                        <p>${(prompt.tags || []).map(t => `#${t}`).join(' ')}</p>
                        <p style="font-size: 12px;">‚ù§Ô∏è ${(prompt.likes || 0).toLocaleString()} likes ‚Ä¢ Added ${prompt.date || 'Unknown'}</p>
                    </div>
                    <div class="prompt-actions">
                        <button class="btn-small btn-delete" onclick="deletePrompt('${prompt.id}')">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function exportData() {
            const dataStr = JSON.stringify(prompts, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `promptvault_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            showAlert('Data exported successfully!', 'success');
        }

        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            container.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        // Auto-login if session exists
        if (sessionStorage.getItem('admin_logged_in') === 'true') {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminPanel').classList.add('active');
            loadDashboard();
        }

        // Preview image on URL change
        document.getElementById('imageUrl').addEventListener('input', (e) => {
            const url = e.target.value;
            if (url) {
                const existingPreview = document.querySelector('.image-preview');
                if (existingPreview) existingPreview.remove();
                
                const img = document.createElement('img');
                img.src = url;
                img.className = 'image-preview';
                img.onerror = () => {
                    showAlert('‚ö†Ô∏è Invalid image URL', 'error');
                };
                e.target.parentElement.appendChild(img);
            }
        });

        // Update tags display
        document.getElementById('tagsInput').addEventListener('input', (e) => {
            const tags = e.target.value.split(',').map(t => t.trim()).filter(t => t);
            const display = document.getElementById('tagsDisplay');
            display.innerHTML = tags.map(tag => `
                <div class="tag-chip">#${tag}</div>
            `).join('');
        });
    </script>

    <!-- üî• FIREBASE SDK -->
    <script type="module">
        // Import Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDtOe7B00n6c8SYvoQpRYqbP_B89UY8sfA",
            authDomain: "promptvault-637f7.firebaseapp.com",
            projectId: "promptvault-637f7",
            storageBucket: "promptvault-637f7.firebasestorage.app",
            messagingSenderId: "16809923431",
            appId: "1:16809923431:web:83f03ff602dc759c7295c2",
            measurementId: "G-D9EYFK29WH"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        console.log('üî• Firebase initialized!');

        // Add prompt to Firebase
        window.addPromptToFirebase = async function(promptData) {
            try {
                const docRef = await addDoc(collection(db, "prompts"), {
                    image: promptData.image,
                    prompt: promptData.prompt,
                    tags: promptData.tags,
                    likes: promptData.likes || 0,
                    date: promptData.date || new Date().toISOString().split('T')[0]
                });
                console.log('‚úÖ Prompt added with ID:', docRef.id);
                return docRef.id;
            } catch (error) {
                console.error('‚ùå Error adding prompt:', error);
                throw error;
            }
        };

        // Delete prompt from Firebase
        window.deletePromptFromFirebase = async function(promptId) {
            try {
                await deleteDoc(doc(db, "prompts", promptId));
                console.log('‚úÖ Prompt deleted:', promptId);
            } catch (error) {
                console.error('‚ùå Error deleting prompt:', error);
                throw error;
            }
        };

        // Load prompts from Firebase
        window.loadPromptsFromFirebase = async function() {
            try {
                const querySnapshot = await getDocs(collection(db, "prompts"));
                const firebasePrompts = [];
                
                querySnapshot.forEach((docSnapshot) => {
                    const data = docSnapshot.data();
                    firebasePrompts.push({
                        id: docSnapshot.id,
                        image: data.image,
                        prompt: data.prompt,
                        tags: data.tags || [],
                        likes: data.likes || 0,
                        date: data.date
                    });
                });

                window.prompts = firebasePrompts;
                prompts = firebasePrompts;

                console.log('‚úÖ Loaded', firebasePrompts.length, 'prompts from Firebase');
                return firebasePrompts;
            } catch (error) {
                console.error('‚ùå Error loading prompts:', error);
                return [];
            }
        };

        console.log('‚úÖ Firebase functions ready!');
    </script>
</body>
</html>
